<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find your path to #Fitter #Stronger #Better | COACH CHRIS</title>
    
    <meta property="og:title" content="Find your path to #Fitter #Stronger #Better">
    <meta property="og:description" content="Take our short discovery session to determine which service is best suited to help you achieve your goals">
    <meta property="og:image" content="https://placehold.co/1200x630/22c55e/000?text=COACH+CHRIS+Fitness+Consultation">
    <meta property="og:url" content="YOUR_APP_URL_HERE">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Find your path to #Fitter #Stronger #Better">
    <meta name="twitter:description" content="Take our short discovery session to determine which service is best suited to help you achieve your goals">
    <meta name="twitter:image" content="https://placehold.co/1200x630/22c55e/000?text=COACH+CHRIS+Fitness+Consultation">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        /* --- BACKGROUND & GLASSMORPHISM CORE --- */
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at 20% 20%, #1a1a1a 0%, #000 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before, body::after {
            content: "";
            position: fixed;
            width: 40vw;
            height: 40vw;
            border-radius: 50%;
            background: rgba(34, 197, 94, 0.15);
            filter: blur(100px);
            z-index: -1;
            animation: move 20s infinite alternate;
        }
        body::after {
            background: rgba(34, 197, 94, 0.1);
            right: -10%;
            top: 20%;
            animation-delay: -5s;
        }
        @keyframes move {
            from { transform: translate(-10%, -10%); }
            to { transform: translate(10%, 10%); }
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        #initial-loader {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease-out;
        }

        .cycling-text {
            font-family: monospace;
            color: #22c55e;
            font-size: 0.75rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-top: 1rem;
            min-height: 1.2em;
        }

        .quiz-container {
            max-width: 650px;
            min-height: 550px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .option-button {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: #fff;
            font-weight: 500;
            transition: all 0.2s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .option-button:hover:not(.selected) {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(34, 197, 94, 0.5);
            transform: translateX(4px);
        }

        .selected {
            background: rgba(34, 197, 94, 0.2) !important;
            border-color: #22c55e !important;
            color: #fff !important;
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.2);
        }

        .check-icon {
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            color: #22c55e;
        }
        .selected .check-icon {
            opacity: 1;
            transform: scale(1);
        }

        .action-button {
            background: #22c55e;
            color: #000;
            font-weight: 800;
            text-transform: uppercase;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
        }
        
        .action-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.6);
            filter: brightness(1.1);
        }
        
        .action-button:disabled {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.3);
            box-shadow: none;
            cursor: not-allowed;
        }
        
        .secondary-button {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.15);
            font-weight: 600;
            transition: all 0.2s;
        }
        .secondary-button:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .whatsapp-button {
            background: #25D366;
            color: #fff;
            font-weight: 700;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.2);
        }
        .whatsapp-button:hover {
            transform: translateY(-1px);
            filter: brightness(1.05);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.3);
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.1);
        }
        .progress-bar-fill {
            background: linear-gradient(90deg, #22c55e, #4ade80);
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.5);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .animate-in {
            animation: slideUpFade 0.5s ease-out forwards;
        }

        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .custom-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: white;
            transition: all 0.2s;
        }
        .custom-input:focus {
            outline: none;
            border-color: #22c55e;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.2);
        }
        
        input[type="checkbox"] {
            -webkit-appearance: none;
            appearance: none;
            width: 1.25rem; height: 1.25rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            cursor: pointer;
            position: relative;
        }
        input[type="checkbox"]:checked {
            background: #22c55e;
            border-color: #22c55e;
        }
        input[type="checkbox"]:checked::after {
            content: 'âœ“';
            position: absolute;
            color: black;
            font-weight: bold;
            font-size: 0.8rem;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .clean-spinner {
            width: 50px; height: 50px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid #22c55e;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }

        .result-content-wrap {
            border-top: 1px solid rgba(255,255,255,0.08);
            margin-top: 1.5rem;
            padding-top: 1.5rem;
        }

        .section-header {
            border-left: 2px solid #22c55e;
            padding-left: 1rem;
            margin-bottom: 2rem;
        }

        html {
            scroll-behavior: smooth;
        }

        .summary-tag {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 12px;
            padding: 10px;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-4 sm:p-6">

    <div id="initial-loader">
        <div class="loader-content flex flex-col items-center text-center">
            <h1 class="text-4xl font-black text-white uppercase tracking-tighter italic">DIGITAL CONSULTATION</h1>
            <div id="loader-pulse-text" class="text-green-500 font-bold text-xl uppercase tracking-widest mt-2">Loading...</div>
            <div id="loader-sub-text" class="cycling-text">Initializing consultation...</div>
        </div>
    </div>

    <div id="quiz-app" class="quiz-container glass-panel w-full rounded-3xl p-6 md:p-10 relative overflow-hidden">
        
        <div class="absolute top-0 left-0 w-full h-1.5 bg-green-500 shadow-[0_0_15px_rgba(34,197,94,0.8)]"></div>

        <div id="branding-block" class="mb-8 animate-in">
            <h1 class="text-3xl sm:text-4xl font-black text-white uppercase tracking-tighter leading-none">
                COACH CHRIS
            </h1>
            <div class="flex flex-wrap gap-x-4 gap-y-1 mt-2">
                <p class="text-xs font-bold uppercase text-neutral-400 tracking-widest">CIRCULAR ROOTS COACHING</p>
                <p class="text-xs font-bold uppercase text-green-500 tracking-widest">TRAIN UNCNVNTNL</p>
            </div>
        </div>

        <h2 id="main-title" class="text-2xl sm:text-3xl font-black text-white mb-6 uppercase italic tracking-tight leading-tight">
            FIND YOUR PATH TO BECOMING 
            <span class="text-green-500">#FITTER</span> 
            <span class="text-green-500">#STRONGER</span> 
            <span class="text-green-500">#BETTER</span>
        </h2>
        
        <div id="progress-anchor" class="mb-10">
            <div class="flex items-center justify-between mb-2">
                <p id="progress-text-label" class="text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400">
                    STEP 1 OF 12
                </p>
                <p id="progress-percent" class="text-[10px] font-black text-green-500 tracking-widest">
                    0%
                </p>
            </div>
            <div class="progress-container h-1.5 w-full rounded-full overflow-hidden">
                <div id="progress-bar-fill" class="progress-bar-fill h-full" style="width: 0%;"></div>
            </div>
        </div>

        <div id="content-area">
            <div class="text-center font-bold animate-pulse text-neutral-500">LOADING...</div>
        </div>
    </div>
    
    <div class="mt-12 w-full max-w-2xl text-center px-4">
        <p id="disclaimer" class="text-neutral-500 text-xs mb-6 leading-relaxed max-w-xl mx-auto">
            General Fitness Disclaimer: Always consult your medical professional or doctor before beginning any new fitness regime. This site provides general information for educational purposes only. You engage in physical activity at your own risk.
        </p>
        <p class="text-neutral-400 font-bold text-[10px] uppercase tracking-[0.25em]">
            Â© <span id="current-year">2026</span> COACH CHRIS | CIRCULAR ROOTS COACHING
        </p>
        <p class="text-green-500/50 text-sm italic font-semibold mt-2 tracking-widest">
            Fitter. Stronger. Better.
        </p>
    </div>

    <script>
        const COACH_EMAIL = "circularrootscoaching@gmail.com"; 

        document.getElementById('current-year').textContent = new Date().getFullYear();

        window.addEventListener('load', () => {
            const loader = document.getElementById('initial-loader');
            const subText = document.getElementById('loader-sub-text');
            const cycleMessages = ["Reviewing frameworks...", "Analyzing tier logic...", "Ready."];
            let i = 0;
            const cycleInterval = setInterval(() => {
                if (i < cycleMessages.length) { subText.textContent = cycleMessages[i++]; }
                else { clearInterval(cycleInterval); }
            }, 500);
            setTimeout(() => {
                loader.style.opacity = '0';
                setTimeout(() => { loader.style.display = 'none'; }, 500);
            }, 1800);
        });

        function markdownToHtml(text) {
            if (!text) return "";
            return text.replace(/\*\*(.*?)\*\*/g, '<strong class="text-white">$1</strong>')
                       .replace(/\*(.*?)\*/g, '<em class="text-neutral-300 font-medium">$1</em>');
        }

        const quizData = [
            // PHASE 1: Vision
            { 
                id: 1, 
                section: "Phase 1: The Vision", 
                question: "When you look in the mirror 12 weeks from now, what feeling do you want to experience most?", 
                key: "primaryGoal", 
                summaryLabel: "Primary Goal", 
                options: [
                    { text: "Absolute confidence in how my clothes fit and my body looks", short: "Physique Confidence", score: 30 }, 
                    { text: "The grounded feeling of being physically capable and strong", short: "Functional Strength", score: 20 }, 
                    { text: "Waking up with a surplus of energy for my family, work, and social life", short: "High Energy", score: 10 }, 
                    { text: "The peace of mind that comes with a consistent, healthy routine", short: "Consistency & Peace", score: 5 }
                ] 
            },
            { 
                id: 2, 
                question: "How would your daily life change if you felt 20% more capable in your own skin?", 
                key: "theWhy", 
                summaryLabel: "Your 'Why'", 
                options: [
                    { text: "I'd stop hiding in the back of photos and lead with confidence", short: "Self-Confidence", score: 25, whyId: 'CONFIDENCE' }, 
                    { text: "I'd have the energy to be fully present for my kids and family", short: "Family Vitality", score: 20, whyId: 'FAMILY' }, 
                    { text: "I'd know I'm actively extending my healthy years on this planet", short: "Longevity", score: 30, whyId: 'HEALTH' }, 
                    { text: "I'd have the physical capacity to enjoy my social life and hobbies to the fullest", short: "Active Lifestyle", score: 5, whyId: 'SOCIAL' }
                ] 
            },

            // PHASE 2: Reality
            { 
                id: 3, 
                section: "Phase 2: The Reality", 
                question: "Be honest: what has been the biggest hurdle in reaching your goals so far?", 
                key: "barrier", 
                summaryLabel: "Main Barrier", 
                options: [
                    { text: "I'm overwhelmed by options and lack a simple, effective plan", short: "Overwhelmed", score: 5 }, 
                    { text: "I start strong, but fall off when life gets busy or social", short: "Consistency", score: 20 }, 
                    { text: "I'm training but my nutrition feels like a 'black box' I can't solve", short: "Nutrition Friction", score: 30 }, 
                    { text: "I've hit a plateau and I'm bored with my current routine", short: "Boredom/Plateau", score: 15 }
                ] 
            },
            { 
                id: 4, 
                question: "When life gets 'loud' (work, kids, social events), what usually happens?", 
                key: "lifestyle", 
                options: [
                    { text: "My consistency: I skip sessions until things 'calm down'", score: 30 }, 
                    { text: "My nutrition: I default to whatever is fast and convenient", score: 20 }, 
                    { text: "My recovery: I sacrifice sleep and feel more stressed", score: 10 }, 
                    { text: "Everything: I usually just stop and have to 'start over' later", score: 5 }
                ] 
            },

            // PHASE 3: Philosophy
            { 
                id: 5, 
                section: "Phase 3: The Philosophy", 
                question: "Do you believe that 3 focused, efficient sessions are better than 6 'half-hearted' ones?", 
                key: "commitment", 
                summaryLabel: "Commitment", 
                options: [
                    { text: "Absolutely. I value efficiency and 'minimum effective dose'", short: "Efficiency First", score: 20 }, 
                    { text: "I'm ready to commit to a higher frequency if it's the right path", short: "High Commitment", score: 30 }, 
                    { text: "I need to be convincedâ€”I've always been told more is better", short: "Skeptical/New", score: 10 },
                    { text: "I just need a rhythm I can actually stick to alongside real life", short: "Sustainable Rhythm", score: 5 }
                ] 
            },
            { 
                id: 6, 
                question: "How do you feel about a 'Minimalist' approachâ€”focusing on big moves for sustainable results?", 
                key: "experience", 
                summaryLabel: "Experience", 
                options: [
                    { text: "I'm a beginner; I need you to show me the way", short: "Beginner", score: 5, expId: 'BEGINNER' }, 
                    { text: "I've done it before and it worksâ€”I just need a better plan", short: "Returning", score: 15, expId: 'RETURNING' }, 
                    { text: "I'm experienced and ready to optimize my current results", short: "Experienced", score: 30, expId: 'EXPERIENCED' }
                ] 
            },
            { 
                id: 7, 
                question: "What has been your experience with following a structured plan in the past?", 
                key: "pastExp", 
                options: [
                    { text: "Iâ€™ve never followed a real plan; I just 'wing it'", score: 5, category: 'NEW' },
                    { text: "Iâ€™ve tried PDFs/Apps but they felt disconnected from my life", score: 15, category: 'FRICTION' },
                    { text: "Iâ€™ve worked with a coach and know that's where the results are", score: 30, category: 'COACHED' },
                    { text: "Iâ€™m currently training but I feel like I'm just spinning my wheels", score: 20, category: 'PLATEAU' }
                ] 
            },
            { 
                id: 8, 
                question: "Which of these best describes your current nutrition status?", 
                key: "nutrition", 
                options: [
                    { text: "I'm ready for a total overhaul and a clear strategy", score: 10 }, 
                    { text: "I eat 'okay' but I'm missing the structure to see real change", score: 20 }, 
                    { text: "I track everything and just need refinement for better energy", score: 30 }, 
                    { text: "I'm overwhelmed by food choices and don't know where to start", score: 5 }
                ] 
            },

            // PHASE 4: Logistics
            { 
                id: 9, 
                section: "Phase 4: The Logistics", 
                question: "Where will your training take place?", 
                key: "location", 
                options: [
                    { text: "A fully equipped commercial or home gym", score: 30 }, 
                    { text: "At home with minimal kit (dumbbells/kettlebells)", score: 10 }, 
                    { text: "Mostly bodyweight or outdoor training", score: 20 }, 
                    { text: "It's a mix: I travel often or move around for work/pleasure", score: 5 }
                ] 
            },
            { 
                id: 10, 
                question: "Do you have any injuries or movement restrictions I need to know about?", 
                key: "medical", 
                summaryLabel: "Medical", 
                options: [
                    { text: "Yes, I have current injuries that need expert modification", short: "Injury Concerns", score: 100 }, 
                    { text: "Just the usual 'desk job' aches and minor niggles", short: "Minor Aches", score: 20 }, 
                    { text: "None. I'm ready to move without restriction", short: "Injury Free", score: 10 }, 
                    { text: "I'm not sureâ€”I haven't pushed myself in a while", short: "Uncertain", score: 5 }
                ] 
            },
            { 
                id: 11, 
                question: "What level of partnership are you looking for to guarantee success?", 
                key: "budget", 
                summaryLabel: "Partnership", 
                options: [
                    { text: "Total Partnership: 1-1 access to manage every variable", short: "1-1 Premium", score: 30, budgetId: 'PREMIUM' }, 
                    { text: "Collaborative: Group accountability and expert programming", short: "Collaborative", score: 20, budgetId: 'MID' }, 
                    { text: "Independent: Just give me the tools and I'll do the work", short: "Independent", score: 10, budgetId: 'ENTRY' }, 
                    { text: "I want to see what you recommend based on my life", short: "Flexible", score: 25, budgetId: 'FLEX' }
                ] 
            },
            { 
                id: 12, 
                question: "What level of support do you need to stay on track?", 
                key: "support", 
                options: [
                    { text: "I need high-level accountability and frequent check-ins", score: 30 }, 
                    { text: "I need a community and a coach I can reach out to", score: 20 }, 
                    { text: "I just need a rock-solid program I can trust", score: 5 }, 
                    { text: "I'm not sure yet", score: 10 }
                ] 
            }
        ];

        const phaseTransitions = [
            { triggerIndex: 2, title: "Reality Check", message: "Great vision. Now, letâ€™s get honest about the hurdles so we can build a path that actually fits your lifestyle." },
            { triggerIndex: 4, title: "The Pivot", message: "Understood. Let's look at how we can train smarter, not just longer, to get you where you want to be." },
            { triggerIndex: 8, title: "Final Details", message: "Almost there. Just a few logistical details to see which #FSB path suits you best." }
        ];

        const TIER_1_TITLE = "1-1 ONLINE COACHING";
        const TIER_2_TITLE = "FITTER STRONGER BETTER SUBSCRIPTION";
        const TIER_3_TITLE = "ONLINE PROGRAM LIBRARY";
        const FOUNDATIONS_TITLE = "14-DAY FUNDAMENTALS & 6-WEEK FOUNDATIONS";
        
        function getProgramDetailsByTitle(title) {
            if (title.includes(TIER_1_TITLE)) {
                return {
                    title: TIER_1_TITLE,
                    description: "Your goals require maximum accountability and a highly personalized approach.",
                    briefOverview: "Exclusive 1-on-1 coaching offering fully customized training and nutrition programming. Includes weekly in-depth check-ins and unlimited messaging with Coach Chris.", 
                    accentColor: "text-green-400",
                    ctaLink: "https://coachchriscrc.github.io/oc-lp",
                    requiresCall: true,
                    priceId: 'PREMIUM'
                };
            } else if (title.includes(FOUNDATIONS_TITLE)) {
                return {
                    title: FOUNDATIONS_TITLE,
                    description: "You need a clear, sustainable starting line.",
                    briefOverview: "Begin with our **Free 14-Day Fundamentals**. This leads directly into our **6-Week Foundations Program (Â£99)**â€”a coach-guided experience to build your lasting base.",
                    accentColor: "text-orange-400",
                    ctaLink: "https://coachchriscrc.github.io/14dayfundamentals-lp",
                    requiresCall: false,
                    priceId: 'ENTRY'
                };
            } else if (title.includes(TIER_2_TITLE)) {
                return {
                    title: TIER_2_TITLE,
                    description: "You have clear goals and are ready for a structured rhythm.",
                    briefOverview: "Access our Flagship Hybrid program via our dedicated app. Includes nutrition targets, monthly check-ins, and community support.", 
                    accentColor: "text-blue-400",
                    ctaLink: "https://coachchriscrc.github.io/fsb-lp",
                    requiresCall: true,
                    priceId: 'MID'
                };
            } else {
                return {
                    title: TIER_3_TITLE,
                    description: "Expert-designed guidance you can follow at your own pace.",
                    briefOverview: "Gain self-guided access to professionally built plans. Features full tutorials and movement demosâ€”perfect for the independent trainee.", 
                    accentColor: "text-neutral-300",
                    ctaLink: "https://coachchriscrc.github.io/programs-lp",
                    requiresCall: false,
                    priceId: 'ENTRY'
                };
            }
        }
        
        function getRecommendation(score, answers) {
            const budgetId = answers.find(a => a.key === 'budget')?.budgetId || 'FLEX';
            const expId = answers.find(a => a.key === 'experience')?.expId || 'BEGINNER';
            const medical = answers.find(a => a.key === 'medical')?.answer || '';
            const pastExp = answers.find(a => a.key === 'pastExp')?.category || 'NEW';
            
            if (medical.includes("expert modification")) return getProgramDetailsByTitle(TIER_1_TITLE);
            if (pastExp === 'COACHED' && (budgetId === 'PREMIUM' || budgetId === 'FLEX')) return getProgramDetailsByTitle(TIER_1_TITLE);
            if (budgetId === 'PREMIUM') return getProgramDetailsByTitle(TIER_1_TITLE); 
            
            if (expId === 'BEGINNER' || expId === 'RETURNING' || pastExp === 'NEW' || pastExp === 'FRICTION') {
                if (budgetId === 'ENTRY' && pastExp !== 'FRICTION') return getProgramDetailsByTitle(TIER_3_TITLE);
                return getProgramDetailsByTitle(FOUNDATIONS_TITLE);
            }

            if (score >= 170 && budgetId !== 'ENTRY') return getProgramDetailsByTitle(TIER_2_TITLE);
            return getProgramDetailsByTitle(TIER_3_TITLE);
        }
        
        function getAlternativeRecommendation(primary, score, answers) {
            const budgetId = answers.find(a => a.key === 'budget')?.budgetId || 'FLEX';
            const expId = answers.find(a => a.key === 'experience')?.expId || 'BEGINNER';

            if (primary.title.includes(TIER_1_TITLE)) {
                if (expId === 'EXPERIENCED') return { ...getProgramDetailsByTitle(TIER_2_TITLE), type: 'DOWNGRADE' };
                return { ...getProgramDetailsByTitle(FOUNDATIONS_TITLE), type: 'DOWNGRADE' };
            } 
            
            if (primary.title.includes(FOUNDATIONS_TITLE)) return { ...getProgramDetailsByTitle(TIER_3_TITLE), type: 'DOWNGRADE' };
            if (primary.title.includes(TIER_3_TITLE)) {
                if (expId === 'BEGINNER' || expId === 'RETURNING') return { ...getProgramDetailsByTitle(FOUNDATIONS_TITLE), type: 'UPGRADE' };
                return { ...getProgramDetailsByTitle(TIER_2_TITLE), type: 'UPGRADE' };
            }
            return { ...getProgramDetailsByTitle(TIER_1_TITLE), type: 'UPGRADE' };
        }
        
        function generatePersonalizedRationale(answers, recommendationTitle, isCleanText = false) {
            const rawGoal = answers.find(a => a.key === 'primaryGoal')?.answer || 'your goals';
            const rawBarrier = answers.find(a => a.key === 'barrier')?.answer || 'obstacles';
            const medical = answers.find(a => a.key === 'medical')?.answer || '';
            
            if (medical.includes("expert modification")) {
                let txt = `Because you reported injury concerns, I recommend the 1-1 Coaching path. A custom approach ensures we build through limitations safely rather than just 'working around' them.`;
                return isCleanText ? txt : markdownToHtml(txt);
            }

            let rationale = `Based on your profile, the **${recommendationTitle}** path is strategically designed to solve the challenge of **${rawBarrier}** while helping you reach **${rawGoal}**. We focus on efficiency, ensuring your progress fits your life.`;
            return isCleanText ? rationale : markdownToHtml(rationale);
        }

        function generateThreeMonthVision(answers) {
            const rawGoal = answers.find(a => a.key === 'primaryGoal')?.answer || '';
            const theWhyId = answers.find(a => a.key === 'theWhy')?.whyId || 'HEALTH';
            
            let vision = "In 90 days, if you stay consistent: ";
            if (rawGoal.includes("clothes fit")) vision += "You'll have finished a 12-week transformation where your clothes fit noticeably better and habits are locked in.";
            else if (rawGoal.includes("functional strength")) vision += "You'll have a rock-solid foundation, lifting with confidence and feeling capable in every daily movement.";
            else vision += "Training will be a natural part of your weekly rhythm, and your energy levels will be consistently higher.";

            return vision;
        }

        function generateAlternativeDescription(primaryRec, altRec, answers) {
            if (!altRec) return "";
            let d = '';
            if (altRec.type === 'UPGRADE') {
                d = altRec.priceId === 'PREMIUM' ? `For maximum accountability, step up to **1-1 Coaching**.` : `Once mastered, the **FSB Subscription** is your long-term home for strength.`;
            } else {
                d = `For a more budget-conscious, self-guided approach, the **Program Library** is your best bet.`;
            }
            return markdownToHtml(d);
        }

        let currentStep = 0, totalScore = 0, selectedOption = null, userAnswers = [], clientName = "Warrior", clientEmail = "", isTransitioning = false, isAtWelcome = true;
        const contentArea = document.getElementById('content-area');
        const progressBarFill = document.getElementById('progress-bar-fill');
        const progressTextLabel = document.getElementById('progress-text-label'); 
        const progressPercent = document.getElementById('progress-percent'); 

        function updateProgress() {
            if (isAtWelcome) {
                progressBarFill.style.width = '0%'; progressPercent.textContent = '0%';
                progressTextLabel.textContent = 'CONSULTATION INITIALIZED';
                return;
            }
            const total = quizData.length;
            const progress = (currentStep / total) * 100;
            progressBarFill.style.width = `${progress}%`;
            progressPercent.textContent = `${Math.round(progress)}%`;
            if (currentStep < total) progressTextLabel.textContent = `STEP ${currentStep + 1} OF ${total}`;
            else progressTextLabel.textContent = `CONSULTATION COMPLETE`;
        }

        function scrollToTarget() {
            const anchor = document.getElementById('progress-anchor');
            if (anchor) {
                const offset = 30; 
                const elementPosition = anchor.getBoundingClientRect().top + window.pageYOffset;
                window.scrollTo({ top: elementPosition - offset, behavior: 'smooth' });
            }
        }

        function renderWelcomeScreen() {
            isAtWelcome = true;
            updateProgress();
            contentArea.innerHTML = `
                <div class="animate-in space-y-8">
                    <p class="text-neutral-400 text-sm leading-relaxed">
                        This 2-minute session maps your baseline against your ultimate vision to find your optimal roadmap to becoming <strong class="text-white">#Fitter #Stronger #Better</strong>.
                    </p>
                    <div class="space-y-4">
                        <div class="flex items-center gap-4 p-4 rounded-2xl bg-white/5 border border-white/10 text-xs font-bold uppercase text-white"><span class="bg-green-500/20 p-2 rounded-lg text-green-500">âœ“</span> Personalized Path</div>
                        <div class="flex items-center gap-4 p-4 rounded-2xl bg-white/5 border border-white/10 text-xs font-bold uppercase text-white"><span class="bg-green-500/20 p-2 rounded-lg text-green-500">âœ“</span> 3-Month Vision</div>
                    </div>
                    <button id="start-btn" class="action-button w-full py-5 rounded-2xl text-sm tracking-widest flex items-center justify-center gap-3 group">
                        START CONSULTATION
                        <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 7l5 5m0 0l-5 5m5-5H6" /></svg>
                    </button>
                </div>
            `;
            document.getElementById('start-btn').addEventListener('click', () => { isAtWelcome = false; renderQuestion(); scrollToTarget(); });
        }

        function renderQuestion() {
            if (isAtWelcome) { renderWelcomeScreen(); return; }
            if (currentStep >= quizData.length) { renderNameInputScreen(); return; }
            
            const stepData = quizData[currentStep];
            const prev = userAnswers.find(a => a.key === stepData.key);
            selectedOption = prev ? stepData.options.find(opt => opt.text === prev.answer) : null;
            contentArea.innerHTML = ''; 
            const nextText = currentStep === quizData.length - 1 ? 'SUBMIT' : 'CONTINUE';

            let sectionHtml = stepData.section ? `<div class="section-header animate-in"><p class="text-[10px] font-black uppercase text-green-500 mb-1">New Phase</p><h3 class="text-lg font-black uppercase text-white tracking-tight">${stepData.section}</h3></div>` : "";

            const div = document.createElement('div');
            div.className = 'animate-in';
            div.innerHTML = `
                ${sectionHtml}
                <h2 class="text-xl sm:text-2xl font-bold text-white leading-snug mb-8">${stepData.question}</h2>
                <div id="options-container" class="space-y-3"></div>
                <div class="flex space-x-4 mt-12">
                    <button id="back-button" class="secondary-button w-1/3 p-4 text-sm uppercase tracking-widest rounded-2xl">BACK</button>
                    <button id="next-button" ${selectedOption ? '' : 'disabled'} class="action-button flex-grow p-4 text-sm uppercase tracking-widest rounded-2xl">${nextText}</button>
                </div>
            `;
            contentArea.appendChild(div);

            const container = document.getElementById('options-container');
            const nextBtn = document.getElementById('next-button');
            document.getElementById('back-button').addEventListener('click', handleBack);

            stepData.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-button w-full text-left p-5 rounded-2xl text-base group';
                btn.innerHTML = `<span>${opt.text}</span><svg class="check-icon h-5 w-5 shrink-0 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" /></svg>`;
                if (selectedOption && opt.text === selectedOption.text) btn.classList.add('selected');
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.option-button').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    selectedOption = opt; nextBtn.disabled = false;
                });
                container.appendChild(btn);
            });
            nextBtn.addEventListener('click', handleNext);
            updateProgress();
        }

        function renderTransitionScreen(transition) {
            isTransitioning = true;
            contentArea.innerHTML = `
                <div class="text-center animate-in min-h-[350px] flex flex-col items-center justify-center space-y-8">
                    <h2 class="text-3xl font-black uppercase text-white italic tracking-tighter mb-4">${transition.title}</h2>
                    <p class="text-neutral-400 text-base max-w-sm mx-auto leading-relaxed">${transition.message}</p>
                    <button id="continue-milestone" class="action-button px-10 py-4 rounded-2xl text-xs tracking-widest">CONTINUE</button>
                </div>
            `;
            document.getElementById('continue-milestone').addEventListener('click', () => { isTransitioning = false; renderQuestion(); scrollToTarget(); });
        }
        
        function renderNameInputScreen() {
             currentStep = quizData.length; updateProgress();
             let summaryGridHtml = '<div class="grid grid-cols-2 gap-3 mb-8">';
             quizData.filter(q => q.summaryLabel).forEach(q => {
                 const answer = userAnswers.find(a => a.key === q.key);
                 summaryGridHtml += `<div class="summary-tag"><p class="text-[8px] font-black uppercase text-neutral-500 tracking-widest mb-1">${q.summaryLabel}</p><p class="text-[10px] font-bold text-green-500 truncate">${answer ? (answer.short || answer.answer) : 'â€”'}</p></div>`;
             });
             summaryGridHtml += '</div>';

             contentArea.innerHTML = `
                 <div class="text-center animate-in mb-8">
                     <h2 class="text-2xl font-black uppercase italic tracking-tighter text-white">Review Your Profile</h2>
                 </div>
                 ${summaryGridHtml}
                 <form id="personalization-form" class="space-y-5">
                     <input type="text" id="client-name-input" required class="custom-input block w-full p-4 rounded-xl" placeholder="FIRST NAME">
                     <input type="email" id="client-email-input" required class="custom-input block w-full p-4 rounded-xl" placeholder="EMAIL ADDRESS">
                     <div class="flex items-start py-2">
                        <input type="checkbox" id="disclaimer-check" required class="mt-1">
                        <label for="disclaimer-check" class="ml-3 text-xs text-neutral-400">I agree to the <a href="#disclaimer" class="font-bold underline text-white">disclaimer</a>.</label>
                    </div>
                     <button type="submit" id="display-button" disabled class="action-button w-full py-5 rounded-2xl text-sm tracking-widest">VIEW ANALYSIS</button>
                 </form>
             `;
             document.getElementById('personalization-form').addEventListener('submit', handlePersonalize);
             const upd = () => {
                 const name = document.getElementById('client-name-input').value.trim();
                 const email = document.getElementById('client-email-input').value.trim();
                 const check = document.getElementById('disclaimer-check').checked;
                 document.getElementById('display-button').disabled = !(name && email.includes('@') && check);
             };
             ['client-name-input', 'client-email-input'].forEach(id => document.getElementById(id).addEventListener('input', upd));
             document.getElementById('disclaimer-check').addEventListener('change', upd);
        }

        async function triggerAssessmentSubmission(primary, rationale, vision) {
            const coachData = {
                _subject: `ðŸ”¥ NEW DISCOVERY SESSION: ${clientName} (${primary.title})`,
                _template: "table",
                _replyto: clientEmail, 
                Name: clientName, Email: clientEmail, Recommended: primary.title,
                ...Object.fromEntries(userAnswers.map(a => [a.question, a.answer]))
            };
            try {
                await fetch(`https://formsubmit.co/ajax/${COACH_EMAIL}`, {
                    method: "POST", headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(coachData)
                });
            } catch (error) { console.error("Sync failed", error); }
        }

        function renderLoadingScreen() {
             contentArea.innerHTML = `<div class="text-center min-h-[350px] flex flex-col items-center justify-center"><div class="clean-spinner mb-8"></div><p class="text-2xl font-black uppercase italic tracking-tighter text-white animate-pulse">Analyzing...</p></div>`;
             const primary = getRecommendation(totalScore, userAnswers);
             const cleanRationale = generatePersonalizedRationale(userAnswers, primary.title, true);
             const vision = generateThreeMonthVision(userAnswers);
             triggerAssessmentSubmission(primary, cleanRationale, vision);
             setTimeout(() => { renderFinalProgramSummary(); window.scrollTo({top: 0, behavior: 'smooth'}); }, 2500);
        }

        function renderFinalProgramSummary() {
            const primary = getRecommendation(totalScore, userAnswers);
            const alt = getAlternativeRecommendation(primary, totalScore, userAnswers);
            const rationale = generatePersonalizedRationale(userAnswers, primary.title);
            const vision = generateThreeMonthVision(userAnswers);
            const whatsappMsg = encodeURIComponent(`Hi Chris, it's ${clientName}! I just finished the digital consultation and my result was ${primary.title}.`);
            const showWhatsApp = !primary.title.includes(TIER_3_TITLE);

            contentArea.innerHTML = `
                <div class="animate-in space-y-10">
                    <div class="text-center">
                        <p class="text-[10px] font-black uppercase text-green-500 tracking-[0.3em]">Recommendation for ${clientName.toUpperCase()}</p>
                        <h1 class="text-3xl font-black uppercase text-white italic">Your Optimal Path</h1>
                    </div>
                    <div class="result-content-wrap">
                        <h2 class="text-3xl font-black uppercase ${primary.accentColor} mb-4">${primary.title}</h2>
                        <p class="text-neutral-300 text-sm leading-relaxed mb-6">${primary.briefOverview}</p>
                        <div class="py-4 border-y border-white/5 text-xs italic text-neutral-400">${rationale}</div>
                        <div class="flex flex-col gap-3 pt-6">
                            <a href="${primary.ctaLink}" target="_blank" class="action-button w-full block py-5 rounded-2xl text-sm text-center no-underline tracking-widest">GET THE FULL BREAKDOWN</a>
                            ${showWhatsApp ? `<a href="https://wa.me/447925116794?text=${whatsappMsg}" target="_blank" class="whatsapp-button w-full flex items-center justify-center gap-2 py-4 rounded-2xl text-xs text-center no-underline tracking-widest">ASK COACH CHRIS A QUESTION</a>` : ''}
                        </div>
                    </div>
                    <div class="p-6 rounded-3xl bg-green-500/[0.03] border border-green-500/20">
                        <p class="text-[10px] font-black uppercase text-green-500 mb-2">Your 3-Month Vision</p>
                        <p class="text-sm text-neutral-200 italic">"${vision}"</p>
                    </div>
                    ${alt ? `<div class="pt-4 border-t border-white/5"><h3 class="text-[10px] font-black uppercase text-neutral-500 mb-2">${alt.type === 'UPGRADE' ? 'Step Up' : 'Alternative Path'}</h3><p class="text-xl font-black uppercase ${alt.accentColor}">${alt.title}</p><a href="${alt.ctaLink}" target="_blank" class="text-[10px] text-green-500 underline uppercase tracking-widest mt-2 block">View Alternative</a></div>` : ''}
                    <button id="restart-button" class="secondary-button w-full py-4 rounded-2xl text-[10px] tracking-widest uppercase mt-8">RESTART</button>
                </div>
            `;
            document.getElementById('restart-button').addEventListener('click', restartQuiz);
        }

        function handleNext() {
            if (selectedOption !== null && !isTransitioning) {
                const key = quizData[currentStep].key;
                const idx = userAnswers.findIndex(a => a.key === key);
                if (idx !== -1) { totalScore -= userAnswers[idx].score; userAnswers.splice(idx, 1); } 
                userAnswers.push({ key, question: quizData[currentStep].question, answer: selectedOption.text, short: selectedOption.short, score: selectedOption.score, budgetId: selectedOption.budgetId, expId: selectedOption.expId, whyId: selectedOption.whyId, category: selectedOption.category });
                totalScore += selectedOption.score; currentStep++;
                const transition = phaseTransitions.find(t => t.triggerIndex === currentStep);
                if (transition) { renderTransitionScreen(transition); updateProgress(); } else { renderQuestion(); }
                scrollToTarget();
            }
        }
        
        function handleBack() { 
            if (currentStep === 0) { isAtWelcome = true; renderWelcomeScreen(); } 
            else { currentStep = Math.max(0, currentStep - 1); isTransitioning = false; renderQuestion(); }
            scrollToTarget(); 
        }
        
        function handlePersonalize(e) { 
            e.preventDefault(); 
            clientName = document.getElementById('client-name-input').value.trim().split(' ')[0]; 
            clientEmail = document.getElementById('client-email-input').value.trim();
            renderLoadingScreen(); scrollToTarget(); 
        }
        
        function restartQuiz() { currentStep = 0; totalScore = 0; selectedOption = null; userAnswers = []; clientName = "Warrior"; clientEmail = ""; isTransitioning = false; isAtWelcome = true; renderWelcomeScreen(); scrollToTarget(); }
        document.addEventListener('DOMContentLoaded', () => { renderWelcomeScreen(); });
    </script>
</body>
</html>
